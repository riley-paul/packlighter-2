---
import RootLayout from "@/layouts/root-layout.astro";
import { getExpandedList, getUser } from "@/lib/helpers";

import ViewerCategory from "@/components/list-viewer/viewer-category";

const { listId = "" } = Astro.params;
const list = await getExpandedList(listId);

if (!list) {
  return new Response("List not found", { status: 404 });
}

if (!list.isPublic) {
  return new Response("List is not public", { status: 403 });
}

const listOwner = await getUser(list.userId);

if (!listOwner) {
  return new Response("List owner not found", { status: 404 });
}
---

<RootLayout>
  <h1>View List</h1>
  <p>Viewing list with ID: {listId}</p>
  <p>List name: {list.name}</p>
  <p>owner: {listOwner.name}</p>

  {
    list.categories.map((category) => (
      <ViewerCategory category={category} list={list} />
    ))
  }
</RootLayout>
